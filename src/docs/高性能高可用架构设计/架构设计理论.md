### CAP 理论
#### CAP 定义
<pre>
在一个分布式系统（指互相连接并共享数据的节点的集合）中，当涉及读写操作时，只能保证一致性（Consistence）
、可用性（Availability）、分区容错性（Partition Tolerance）三者中的两个，另外一个必须被牺牲。
与第一版差异：
1.分布式系统不一定会互联和共享数据
2. CAP 理论关注的是数据的读写操作，而不是分布式系统的所有功能。
</pre> 
- 一致性（Consistency） ：对某个指定的客户端来说，读操作保证能够返回最新的写操作结果。
- 可用性（Availability）：非故障的节点在合理的时间内返回合理的响应（不是错误和超时的响应）。
- 分区容忍性（Partition Tolerance）： 当出现网络分区后，系统能够继续“履行职责”。 

#### CAP 类型
- 分布式系统中网络分区的出现是必然事件
- 发生分区故障时，一致性和可用性不可能同时满足
    - 一致性要求禁止写入，而不允许写入则不满足可用性要求
- CP 系统    
- AP 系统

#### CAP 细节特点
- CAP 关注的粒度是数据，而不是整个系统
    - 同一个系统里，可能有些数据选择CP，有些数据选择AP
    - 比如： 用户系统帐号数据选择CP，用户信息数据选择AP
- CAP 是忽略网络延迟的，，而实际应用中延时是无法避免的               
    - 在网络互通的情况下，数据在各个节点上立刻更新
    - 实际上无法做到实时一致性，如： 单个用户余额、单个商品的库存，只能做单点写入
    - 整体设计可以通过数据分区实现分布式
- 正常运行情况下，可以同时满足CA
    - 只有在分区发生的情况下，才需要选择CP还是AP
    - 架构师设计时，纪要考虑分区发生时选择 CP 还是 AP，也要考虑分区没有发生时如何保证 CA 
- 放弃不等于什么都不做，需要为分区恢复后做准备
    - 分区故障解决后，系统要能够重新达到CA的状态
    - 记录日志，分区故障解决后，通过日志进行数据回复
- AP 方案中牺牲一致性只是指分区期间，而不是永远放弃一致性

### BASE 理论
- 基本可用（Basically Available） :分布式系统在出现故障时，允许损失部分可用性，即保证核心可用
- 软状态（Soft State）：允许系统存在中间状态，而该中间状态不会影响系统整体可用性
- 最终一致性（Eventual Consistency）： 系统中的所有数据副本经过一定时间后，最终能够达到一致的状态。
- 是对 CAP 中 AP 方案的一个补充      

### FMEA 方法 
- 墨菲定律 可能出错的事情最终都会出错
- FEMA： Failure mode and effects analysis，故障模式与影响分析 
- 分析步骤
    - 给出初始的架构设计图
    - 假设架构中某个部件发生故障
    - 分析此故障对系统功能造成的影响
    - 根据分析结果，判断架构是否需要进行优化 
- FEMA 分析表
    - 功能点： 从用户角度看
    - 故障模式： 故障点+故障形式，要尽量精确，多用量化描述
        - MySQl响应超过3秒 优于 mysql响应慢
    - 故障影响： 精确+量化
        - 功能点偶尔不可用
        - 功能点完全不可用
        - 部分用户功能点不可用
        - 功能点响应慢
        - 功能点出错
    - 严重程度： 致命/高/中/低/无
    - 故障原因
        - 不同故障原因发生的概率不同
        - 不同故障原因的检测手段不同
        - 不同故障原因的处理措施不一样
    - 故障概率： 高、中、低
        - 硬件      概率低--->高
        - 开源系统  概率高--->低
        - 自研系统  概率高--->低
    - 风险程度： 严重程度 * 故障概率
    - 已有措施： 监测告警、容错、自恢复
    - 规避措施： 技术手段+管理手段
    - 解决措施： 技术手段
    - 后续规划
 
### 如何判断技术演进方向
- 业务分类：产品类、服务类
    - 产品类： 技术创新推动业务发展，用户选择产品的根本驱动力是功能
    - 服务类： 业务推动技术发展，用户选择服务的根本驱动力是规模
        - 服务模式的创新就成为了业务发展的核心驱动力
        - 服务的发展路径： 提出一种创新的服务模式→吸引了一批用户→业务开始发展→→吸引了更多用户→服务模式不断完善和创新→吸引越来越多的用户
- 业务“复杂度”的上升，导致原有的技术无法支撑
    - 复杂度来源：
        - 功能不断叠加
        - 规模扩大，对性能和可用性的更高要求
        - 答案就是基于业务发展阶段进行判断
          
  
                                             
          
    