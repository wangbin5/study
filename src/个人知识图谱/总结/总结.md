- 架构: 解决系统复杂度问题
    - 复杂度来源
        - 高并发/高性能
        - 高可用
        - 可伸缩/可扩展
        - 规模
        - 成本
        - 安全
    - 架构原则
        - 适用原则
        - 演进原则
        - 简单原则
    - 最小可用架构
        - 起步阶段 功能快速实现
        - 发展阶段 可扩展
        - 稳定阶段 优化
- 高可用手段
    - FMEA 方法: 故障模式与影响分析 Failure Mode,Effects Analysis
        - 步骤: 1) 画出简单架构图 2）从功能点触发，找出可能失败的组件（故障模式）3）评估故障风险等级（重要度+发生概率+影响范围）4）现有手段/预计手段是否能够缓解风险
        - 表格内容: 功能点、故障模式、影响范围、故障原因、发生概率、重要程度、风险等级、已有措施、规避措施、计划措施、是否缓解
    - 应用层: 
        - 熔断、限流、降级
            - 限流问题: 1) redis 限流开源库，2) guava限流库 3) Spring Cloud 限流、熔断配置实战
            - 熔断问题: 1) 是否有上报机制 2) 熔断粒度 实例 or 服务
            - 降级问题: 1) 自动降级 Hystrix 2）功能开关- apollo 实现方式
        - 无状态+负载均衡
    - 存储集群（有状态）
        - 读写分离        
        - 主从机制: 监控，主从自动切换
        - 数据分片
        - 缓存
        - 消息队列
    - 隔离
        - 线程池
        - 核心服务，Mysql 独立集群
        - HBase 中 RSGroup（业务间隔离），读写队列隔离
    - At least Once(重试保证)+幂等（去重） = Exactly Once
        - 单组间无法达到“只有一次”
    - 功能分级
        - 独立部署
        - 资源隔离，比如： 数据库
        - 降级策略
        - 依赖关系: 核心服务只能采用异步方式访问非核心服务的接口
    - 避免单点故障/避免中心化         
- 可扩展/伸缩手段
    - AKF 扩展立方体： 
        - 水平扩展  -- 功能拆分 -- 数据分片
        - 水平扩展 多实例+无状态
        - 功能拆分 微服务
        - 数据分片 分库分表、消息队列分区
    - DID 可扩展设计
        - 20倍设计
        - 3倍实施
        - 1.5倍部署
    - 读写分离
    - 存储与计算分离
    - 微内核架构
- 高性能手段
    - 通过异步化，加大吞吐量 
    - 合适的存储： 数据结构/存储结构,合理利用硬件特性，比如: 磁盘顺序写  
    - 连接使用多路分发模式: Epoll+Reactive方式
    - 使用缓存
    - 数据库调优: 配置、语句（执行计划+索引）、锁（粒度问题)
    - 约束理论（瓶颈点）
        - 确定约束点
        - 充分利用约束点，减少不必要/低优先级工作对约束点的使用
        - 其他活动从属于约束点（限流）
        - 提升约束点
        - 找下一个约束点        
- 微服务
    - 服务注册与发现
        - 客户端直连
        - 服务端代理模式
    - 负载均衡
        - 客户端
        - 服务端
    - 配置中心
        - Spring Cloud Config
        - 消息队列+Env
        - 功能开关
        - Spring Endpoint
    - 监控/日志/调用链跟踪
    

### 组件逻辑结构
- 分布式链路跟踪
    - 功能:
        - 使用Trace_id查看调用详情
        - 微服务上下游关系图
        - 统计数据-监控报警
        - 调用列表: 错误/超时/响应时间长
    - 存储方式: hbase
    - 日志采集方式: java agent 采集上报
    - 性能指标
    - 架构图
- 监控
    - 系统级: CPU、内存、磁盘、网络
    - JVM: 线程/线程池,连接池,垃圾回收
    - RPC/REST: 请求数、响应时间、错误率
    - 数据库/存储:
        - Redis: 内存使用率、慢查询
        - MySql: 慢查询、连接数
    - 消息队列: 消息堆积、生产/消费速度
- 消息队列
    - 不丢消息: 发送、接受、存储 三个阶段
    - 重复消息处理: 消费者端幂等处理
    - 堆积消息处理: 因果一致性+多线程/多分区
    - 监控: 不丢消息、消息延迟、待处理队列长度
    - 模式
        - 本地消息表
        - SAGA
    - 集群方案
- 缓存
    - Cache Aside: 1) 更新数据加锁避免缓存穿透 2）避免大量键同时过期 3）防范分页遍历（爬虫）
    - 持久缓存（不过期）: 使用数据库日志更新缓存
    - 集群方案 1）Codis 机制 2） redis 集群

        
                    
    
    