### 负载均衡算法
- 一致性Hash算法
- 轮询与加权轮询


#### 常见负载均衡技术
- Nginx   应用层Http层协议
- HAProxy TCP/IP层
- LVS 
- DNS轮询
- 只能DNS


#### Nginx 方案
- max_client 计算公式
    - worker_processes*worker_connections      php服务器
    - worker_processes*worker_connections/4    反向代理
        - 浏览器建立两条到ng的连接
        - ng 建立2条到对应后端的连接
- http返回数据开启压缩功能
    - 客户端节省流量 4G网络
    - 节省服务器堆外带宽   200元/Mbps
- 动态缩略图模块


#### LVS方案
- 高效原因：对数据链路层报文、IP报文、TCP报文进行修改或封装
- NAT方式
    - 数据流   客户端 --> LVS服务器--> 真实服务器 --> LVS服务器 --> 客户端
    - 真实服务器网关地址设置成LVS地址
    - 转发点（LVS服务器）是瓶颈点
- DR方式
    - 数据流  客户端--> LVS服务器--> 真实服务器 --> 中心交换机 --> 客户端
    - 数据报文重写： 修改数据链路层的报文封装
    - DR改写的是目标服务器的MAC地址
    - 只能进行二层交换，不会修改TCP/IP报文，也就不能做端口映射
    - 真实服务器设置LVS上的VIP为自己的回环IP   --> 避免数据包被丢弃
    - 优点： 解决NAT中转发的性能瓶颈，性能好
    - 缺点： 浪费外网IP，并且LVS与真实服务器必须在一个网段 
- TUN方式
    - 数据报文重新封装： IP隧道
    - 数据流  客户端--> LVS服务器 --> 路由器 --> 真实服务器 --> 中心交换机 --> 客户端

#### DNS和智能DNS
- DNS轮询存在的不足
    - 各服务节点压力不平衡
    - DNS上同步时间会非常慢
- 智能DNS： 保证返回给客户端的域名对应的服务器ip，尽可能离用户足够近
    - 实现原理：使用ip划区表确定客户的位置


#### CDN网络
- 不建议自行搭建CDN网络
- CDN结构
    - 星型CDN： 真实服务器压力比较大
    - 网状CDN： 节点从不同的节点上分别获取文件的不同片段，最后在本地形成完整的文件


#### 负载均衡方案选择
- 方案一： Nginx                       
- 方案二： LVS+nginx       
- 方案三： 使用DNS和CDN
 

    